<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×‘×“×™×§×ª ×—×™×œ×•×¥ ××—×™×¨ TASE (×¢×•×§×£ ×—×¡×™××•×ª)</title>
    <style>
        body { font-family: system-ui, -apple-system, sans-serif; max-width: 600px; margin: 2rem auto; padding: 1rem; background: #f0f2f5; }
        .card { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        input { font-size: 1.2rem; padding: 0.5rem; width: 200px; margin-left: 1rem; border: 1px solid #ccc; border-radius: 6px; }
        button { font-size: 1.2rem; padding: 0.5rem 1.5rem; background: #0070f3; color: white; border: none; border-radius: 6px; cursor: pointer; }
        button:hover { background: #0051a2; }
        #result { margin-top: 1.5rem; padding: 1rem; border-radius: 8px; white-space: pre-wrap; direction: ltr; font-family: monospace; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .loading { color: #666; font-style: italic; }
    </style>
</head>
<body>

<div class="card">
    <h2>ğŸ•µï¸ ×‘×“×™×§×ª ×—×™×œ×•×¥ ×™×©×™×¨ (Client-Side)</h2>
    <p>×”×›× ×¡ ××¡×¤×¨ × ×™×™×¨ (×œ××©×œ 5140454) ×•×œ×—×¥ ×¢×œ ×‘×“×™×§×”.</p>
    
    <div style="display: flex; align-items: center; margin-bottom: 1rem;">
        <label>××¡×¤×¨ × ×™×™×¨: </label>
        <input type="text" id="securityId" value="5140454">
        <button onclick="checkPrice()">×‘×“×•×§ ××—×™×¨</button>
    </div>

    <div id="result">×”×ª×•×¦××•×ª ×™×•×¤×™×¢×• ×›××Ÿ...</div>
</div>

<script>
    async function checkPrice() {
        const id = document.getElementById('securityId').value;
        const resultDiv = document.getElementById('result');
        const funderUrl = `https://www.funder.co.il/fund/${id}`;
        // ×©×™××•×© ×‘×¤×¨×•×§×¡×™ ×›×“×™ ×œ×¢×§×•×£ CORS
        const proxyUrl = `https://corsproxy.io/?${encodeURIComponent(funderUrl)}`;

        resultDiv.className = '';
        resultDiv.innerHTML = `<span class="loading">â³ ××ª×—×‘×¨ ×œ-Funder ×“×¨×š ×¤×¨×•×§×¡×™...</span>`;

        try {
            console.log("Fetching:", proxyUrl);
            const response = await fetch(proxyUrl);
            
            if (!response.ok) throw new Error(`×©×’×™××ª HTTP: ${response.status}`);
            
            const html = await response.text();
            
            // ×œ×•×’×™×§×” ×œ×—×™×œ×•×¥ ×”××—×™×¨ (×‘×“×™×•×§ ×›××• ×‘××¤×œ×™×§×¦×™×”)
            const priceMatch = html.match(/"buyPrice"\s*:\s*([\d\.]+)/);
            const changeMatch = html.match(/"1day"\s*:\s*([-\d\.]+)/);

            if (priceMatch && priceMatch[1]) {
                const price = priceMatch[1];
                const change = changeMatch ? changeMatch[1] : "×œ× × ××¦×";
                
                resultDiv.className = 'success';
                resultDiv.innerHTML = `âœ… <b>×”×¦×œ×—×”! ×”× ×ª×•× ×™× ×—×•×œ×¦×•:</b>\n\n` +
                                      `ğŸ’° ××—×™×¨ ××—×¨×•×Ÿ: <b>${price}</b>\n` +
                                      `ğŸ“‰ ×©×™× ×•×™ ×™×•××™: <b>${change}%</b>\n\n` +
                                      `ğŸ” ××§×•×¨: Funder (×“×¨×š ×”×“×¤×“×¤×Ÿ ×©×œ×š)\n` +
                                      `ğŸ“„ ××•×¨×š ×”×“×£ ×©×™×¨×“: ${html.length} ×ª×•×•×™×`;
            } else {
                resultDiv.className = 'error';
                resultDiv.innerHTML = `âŒ ×”×“×£ ×™×¨×“, ××š ×œ× × ××¦× ×”××—×™×¨ (Regex failed).\n` +
                                      `××•×œ×™ ×”××¡×¤×¨ ×©×’×•×™ ××• ×©×”××‘× ×” ×”×©×ª× ×”.\n` +
                                      `×”×¦×¦×” ×œ×ª×•×›×Ÿ:\n${html.substring(0, 200).replace(/</g, '&lt;')}`;
            }

        } catch (error) {
            resultDiv.className = 'error';
            resultDiv.innerHTML = `âŒ ×©×’×™××” ×‘×—×™×‘×•×¨:\n${error.message}`;
        }
    }
</script>

</body>
</html>